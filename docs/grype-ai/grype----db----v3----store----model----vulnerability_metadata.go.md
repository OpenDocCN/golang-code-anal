# `grype\grype\db\v3\store\model\vulnerability_metadata.go`

```
package model

import (
    "encoding/json"
    "fmt"

    v3 "github.com/anchore/grype/grype/db/v3"
)

const (
    VulnerabilityMetadataTableName = "vulnerability_metadata"
)

// VulnerabilityMetadataModel is a struct used to serialize db.VulnerabilityMetadata information into a sqlite3 DB.
type VulnerabilityMetadataModel struct {
    ID           string `gorm:"primary_key; column:id;"`
    Namespace    string `gorm:"primary_key; column:namespace;"`
    DataSource   string `gorm:"column:data_source"`
    RecordSource string `gorm:"column:record_source"`
    Severity     string `gorm:"column:severity"`
    URLs         string `gorm:"column:urls"`
    Description  string `gorm:"column:description"`
    Cvss         string `gorm:"column:cvss"`
}

// NewVulnerabilityMetadataModel generates a new model from a db.VulnerabilityMetadata struct.
func NewVulnerabilityMetadataModel(metadata v3.VulnerabilityMetadata) VulnerabilityMetadataModel {
    // 将 metadata.URLs 转换为 JSON 字符串
    links, err := json.Marshal(metadata.URLs)
    if err != nil {
        // 如果转换出错，抛出异常
        panic(err)
    }

    // 如果 metadata.Cvss 为空，创建一个空的数组
    if metadata.Cvss == nil {
        metadata.Cvss = make([]v3.Cvss, 0)
    }
    var cvssStr string
    // 将 metadata.Cvss 转换为 JSON 字符串
    cvss, err := json.Marshal(metadata.Cvss)
    if err != nil {
        // 如果转换出错，抛出异常
        panic(err)
    }

    cvssStr = string(cvss)

    // 返回一个新的 VulnerabilityMetadataModel 对象
    return VulnerabilityMetadataModel{
        ID:           metadata.ID,
        Namespace:    metadata.Namespace,
        DataSource:   metadata.DataSource,
        RecordSource: metadata.RecordSource,
        Severity:     metadata.Severity,
        URLs:         string(links),
        Description:  metadata.Description,
        Cvss:         cvssStr,
    }
}

// TableName returns the table which all db.VulnerabilityMetadata model instances are stored into.
func (VulnerabilityMetadataModel) TableName() string {
    return VulnerabilityMetadataTableName
}

// Inflate generates a db.VulnerabilityMetadataModel object from the serialized model instance.
func (m *VulnerabilityMetadataModel) Inflate() (v3.VulnerabilityMetadata, error) {
    // 定义一个空的字符串数组用于存储链接
    var links []string
    // 定义一个空的 Cvss 结构体数组
    var cvss []v3.Cvss

    // 将 URLs 字段的 JSON 数据解析为字符串数组
    if err := json.Unmarshal([]byte(m.URLs), &links); err != nil {
        // 如果解析失败，则返回错误信息
        return v3.VulnerabilityMetadata{}, fmt.Errorf("unable to unmarshal URLs (%+v): %w", m.URLs, err)
    }

    // 将 Cvss 字段的 JSON 数据解析为 Cvss 结构体数组
    err := json.Unmarshal([]byte(m.Cvss), &cvss)
    if err != nil {
        // 如果解析失败，则返回错误信息
        return v3.VulnerabilityMetadata{}, fmt.Errorf("unable to unmarshal cvss data (%+v): %w", m.Cvss, err)
    }

    // 返回解析后的 VulnerabilityMetadata 结构体和 nil 错误
    return v3.VulnerabilityMetadata{
        ID:           m.ID,
        Namespace:    m.Namespace,
        DataSource:   m.DataSource,
        RecordSource: m.RecordSource,
        Severity:     m.Severity,
        URLs:         links,
        Description:  m.Description,
        Cvss:         cvss,
    }, nil
}
```