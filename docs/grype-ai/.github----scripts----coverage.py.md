# `grype\.github\scripts\coverage.py`

```
#!/usr/bin/env python3
# 指定使用 Python3 解释器

import subprocess
# 导入 subprocess 模块，用于执行外部命令

import sys
# 导入 sys 模块，用于访问与 Python 解释器交互的变量和函数

import shlex
# 导入 shlex 模块，用于解析命令行字符串

class bcolors:
    # 定义一个颜色类，用于在终端输出中添加颜色

if len(sys.argv) < 3:
    # 如果命令行参数少于3个
    print("Usage: coverage.py [threshold] [go-coverage-report]")
    # 打印使用说明
# 退出程序并返回状态码1
sys.exit(1)

# 从命令行参数中获取阈值
threshold = float(sys.argv[1])

# 从命令行参数中获取报告文件名
report = sys.argv[2]

# 使用 shlex 模块将命令字符串转换为参数列表
args = shlex.split(f"go tool cover -func {report}")

# 运行子进程并捕获输出
p = subprocess.run(args, capture_output=True, text=True)

# 从子进程的输出中提取覆盖率百分比
percent_coverage = float(p.stdout.splitlines()[-1].split()[-1].replace("%", ""))
print(f"{bcolors.BOLD}Coverage: {percent_coverage}%{bcolors.ENDC}")

# 如果覆盖率低于阈值，则打印警告信息并退出程序
if percent_coverage < threshold:
    print(f"{bcolors.BOLD}{bcolors.FAIL}Coverage below threshold of {threshold}%{bcolors.ENDC}")
    sys.exit(1)
```