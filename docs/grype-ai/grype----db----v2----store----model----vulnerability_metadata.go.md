# `grype\grype\db\v2\store\model\vulnerability_metadata.go`

```go
package model

import (
    "database/sql"  // 导入数据库操作相关的包
    "encoding/json"  // 导入 JSON 编解码相关的包
    "fmt"  // 导入格式化输出相关的包

    v2 "github.com/anchore/grype/grype/db/v2"  // 导入自定义包

)

const (
    VulnerabilityMetadataTableName = "vulnerability_metadata"  // 定义漏洞元数据表的表名常量
)

// VulnerabilityMetadataModel is a struct used to serialize db.VulnerabilityMetadata information into a sqlite3 DB.
type VulnerabilityMetadataModel struct {
    ID           string         `gorm:"primary_key; column:id;"`  // 定义 ID 字段
    RecordSource string         `gorm:"primary_key; column:record_source;"`  // 定义 RecordSource 字段
    Severity     string         `gorm:"column:severity"`  // 定义 Severity 字段
    Links        string         `gorm:"column:links"`  // 定义 Links 字段
    Description  string         `gorm:"column:description"`  // 定义 Description 字段
    CvssV2       sql.NullString `gorm:"column:cvss_v2"`  // 定义 CvssV2 字段
    CvssV3       sql.NullString `gorm:"column:cvss_v3"`  // 定义 CvssV3 字段
}

// NewVulnerabilityMetadataModel generates a new model from a db.VulnerabilityMetadata struct.
func NewVulnerabilityMetadataModel(metadata v2.VulnerabilityMetadata) VulnerabilityMetadataModel {
    links, err := json.Marshal(metadata.Links)  // 将 metadata.Links 转换为 JSON 字符串
    if err != nil {
        // TODO: just no
        panic(err)  // 如果出现错误，触发 panic
    }

    var cvssV2Str sql.NullString  // 定义一个 sql.NullString 类型的变量
    if metadata.CvssV2 != nil {
        cvssV2, err := json.Marshal(*metadata.CvssV2)  // 将 *metadata.CvssV2 转换为 JSON 字符串
        if err != nil {
            // TODO: just no
            panic(err)  // 如果出现错误，触发 panic
        }
        cvssV2Str.String = string(cvssV2)  // 将 JSON 字符串赋值给 cvssV2Str 的 String 字段
        cvssV2Str.Valid = true  // 将 cvssV2Str 的 Valid 字段设置为 true
    }

    var cvssV3Str sql.NullString  // 定义一个 sql.NullString 类型的变量
    if metadata.CvssV3 != nil {
        cvssV3, err := json.Marshal(*metadata.CvssV3)  // 将 *metadata.CvssV3 转换为 JSON 字符串
        if err != nil {
            // TODO: just no
            panic(err)  // 如果出现错误，触发 panic
        }
        cvssV3Str.String = string(cvssV3)  // 将 JSON 字符串赋值给 cvssV3Str 的 String 字段
        cvssV3Str.Valid = true  // 将 cvssV3Str 的 Valid 字段设置为 true
    }

    return VulnerabilityMetadataModel{  // 返回一个 VulnerabilityMetadataModel 结构体
        ID:           metadata.ID,  // 将 metadata.ID 赋值给 ID 字段
        RecordSource: metadata.RecordSource,  // 将 metadata.RecordSource 赋值给 RecordSource 字段
        Severity:     metadata.Severity,  // 将 metadata.Severity 赋值给 Severity 字段
        Links:        string(links),  // 将 links 转换为字符串后赋值给 Links 字段
        Description:  metadata.Description,  // 将 metadata.Description 赋值给 Description 字段
        CvssV2:       cvssV2Str,  // 将 cvssV2Str 赋值给 CvssV2 字段
        CvssV3:       cvssV3Str,  // 将 cvssV3Str 赋值给 CvssV3 字段
    }
}
// TableName返回所有db.VulnerabilityMetadata模型实例存储的表名。
func (VulnerabilityMetadataModel) TableName() string {
    return VulnerabilityMetadataTableName
}

// Inflate从序列化的模型实例生成db.VulnerabilityMetadataModel对象。
func (m *VulnerabilityMetadataModel) Inflate() (v2.VulnerabilityMetadata, error) {
    var links []string
    var cvssV2, cvssV3 *v2.Cvss

    if err := json.Unmarshal([]byte(m.Links), &links); err != nil {
        return v2.VulnerabilityMetadata{}, fmt.Errorf("无法解组链接 (%+v): %w", m.Links, err)
    }

    if m.CvssV2.Valid {
        err := json.Unmarshal([]byte(m.CvssV2.String), &cvssV2)
        if err != nil {
            return v2.VulnerabilityMetadata{}, fmt.Errorf("无法解组cvssV2数据 (%+v): %w", m.CvssV2, err)
        }
    }

    if m.CvssV3.Valid {
        err := json.Unmarshal([]byte(m.CvssV3.String), &cvssV3)
        if err != nil {
            return v2.VulnerabilityMetadata{}, fmt.Errorf("无法解组cvssV3数据 (%+v): %w", m.CvssV3, err)
        }
    }

    return v2.VulnerabilityMetadata{
        ID:           m.ID,
        RecordSource: m.RecordSource,
        Severity:     m.Severity,
        Links:        links,
        Description:  m.Description,
        CvssV2:       cvssV2,
        CvssV3:       cvssV3,
    }, nil
}
```